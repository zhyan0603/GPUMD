# ACNEP 当前状态 - 重要通知

## ⚠️ 目前没有性能提升 ⚠️

如果您编译了 ACNEP 并发现**没有速度提升**，这是**完全正常的**！

### 当前状态

**ACNEP 目前处于基础架构阶段：**

- ✅ 编译系统可用（可以编译 `acnep` 可执行文件）
- ✅ 目录结构已创建
- ✅ 数据结构已定义
- ✅ 文档已编写
- ❌ **优化内核尚未实现**
- ❌ **预计算未激活**
- ❌ **目前没有加速**

### 您正在运行什么

当您运行 `./acnep` 时，您运行的代码与 **NEP 功能完全相同**。唯一的区别是：

1. 不同的启动消息（显示 "ACNEP" 而不是 "NEP"）
2. 分配缓存结构（但不使用它们）
3. 打印关于优化状态的消息

**结果：与 NEP 相同的速度，相同的结果，没有优化。**

### 为什么会这样？

之前的实现创建了优化的**基础架构**：

- 用于缓存的数据结构（`PrecomputedGeometry`）
- 优化的辅助函数
- 文档和指南
- 编译配置

但**没有**实现实际的**优化代码**：

- GPU 邻居列表计算没有预缓存
- 描述符内核仍然重新计算所有内容
- 没有内核融合
- 没有 warp 级优化
- 没有种群批处理

### 需要做什么

要获得实际的加速，必须实现以下内容：

#### 阶段 1：基本预计算（预期 2-5 倍加速）

**文件：** `src/main_acnep/acnep.cu`

添加优化的邻居列表内核：
```cpp
__global__ void gpu_find_neighbor_list_optimized(
  // ... 参数 ...
) {
  // 在启动时计算邻居列表一次
  // 存储在 precomp_geom 数组中
  // 缓存距离以避免后续的 sqrt()
}
```

**文件：** `src/main_acnep/dataset.cu`

更新 `precompute_geometry()` 为：
```cpp
void Dataset::precompute_geometry(Parameters& para) {
  // 启动优化内核
  gpu_find_neighbor_list_optimized<<<Nc, 256>>>(...);
  
  // 标记缓存为有效
  precomp_geom.is_cached = true;
}
```

**文件：** `src/main_acnep/acnep.cu`

更新描述符内核以使用缓存数据：
```cpp
__global__ void find_descriptors_radial(...) {
  // 替换: float d12 = sqrt(x12*x12 + y12*y12 + z12*z12);
  // 为:    float d12 = g_r[index];  // 使用缓存的距离！
}
```

#### 阶段 2：高级优化（额外 2-4 倍）

- 融合径向/角度描述符内核
- 添加 warp 级归约
- 实现种群批处理
- 使用 CUDA 图

**参见：** `src/main_acnep/IMPLEMENTATION_GUIDE.md` 了解详细说明（英文）。

### 如何继续

如果您想帮助实现优化：

1. **阅读指南**：`src/main_acnep/IMPLEMENTATION_GUIDE.md`
2. **从阶段 3 开始**：预计算（影响最大）
3. **增量测试**：一次启用一个优化
4. **验证一致性**：使用 `test_acnep_consistency.sh`
5. **测量加速**：使用相同输入与 `nep` 比较

### 预计实现时间

- **基本预计算**：2-3 天（有经验的 CUDA 开发者）
- **所有优化**：2-3 周
- **最小可行版本**：1 周（预计算 + 基本测试）

### 为什么先发布基础架构？

基础架构优先的方法允许：

1. **验证编译系统**：确保编译正常工作
2. **社区贡献**：其他人可以实现优化
3. **清晰的文档**：实现指南已准备就绪
4. **模块化开发**：每个优化可以逐步添加

### 常见问题

- **问：什么时候会实现优化？**  
  答：基础架构已为贡献者准备就绪。实现时间取决于具有 CUDA 专业知识和 GPU 硬件的开发者的可用性。

- **问：我现在应该使用 ACNEP 吗？**  
  答：不。使用原始的 `nep` 可执行文件。ACNEP 目前没有任何优势。

- **问：我可以贡献吗？**  
  答：可以！遵循 IMPLEMENTATION_GUIDE.md。从阶段 3（预计算）开始。

- **问：如何判断优化是否激活？**  
  答：查看启动消息。如果存根处于活动状态，它会显示 "WARNING: Optimizations are currently in development!"。当优化被实现后，此消息将更改为显示启用了哪些优化。

### 总结

**当前状态：**
```
ACNEP = NEP（性能没有差异）
```

**阶段 1 实现后：**
```
ACNEP = 比 NEP 快 2-5 倍
```

**所有优化后：**
```
ACNEP = 比 NEP 快 4-10 倍（取决于系统）
```

---

**实现帮助，请参见：**
- `IMPLEMENTATION_GUIDE.md` - 分步说明（英文）
- `README_ACNEP.md` - 技术概述（英文）
- `ACNEP_SUMMARY.md` - 项目状态和架构（英文）

**最后更新：** 2026-02-04
